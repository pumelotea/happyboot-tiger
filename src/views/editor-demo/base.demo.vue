<hb-demo>ç¼–è¾‘å™¨ç°åœ¨å·²ç»æŠ½ç¦»ä¸ºç‹¬ç«‹é¡¹ç›®</hb-demo>
<script setup>
import { NInput, NCard } from 'naive-ui'
import '@codecoderun/vivid/dist/style.css'
import { ref } from 'vue'
import {isDark} from "@/global/config";
import { VividEditor } from "@codecoderun/vivid";
import {
  BoldExt,
  BlockQuoteExt,
  CodeExt,
  BulletListExt,
  ColorExt,
  CharacterCountExt,
  CodeBlockExt,
  DocumentExt,
  DropcursorExt,
  GapcursorExt,
  HardBreakExt,
  HeadingExt,
  HighlightExt,
  HistoryExt,
  LinkExt,
  MathExt,
  ImageExt,
  ItalicExt,
  IndentExt,
  HorizontalRuleExt,
  ListItemExt,
  OrderedListExt,
  ParagraphExt,
  PlaceholderExt,
  StrikeExt,
  SubscriptExt,
  SuperscriptExt,
  TableExt,
  TextExt,
  TaskListExt,
  VideoExt,
  UnderlineExt,
  TextAlignExt,
  TextStyleExt,
  DividerExt,
  FormatClearExt,
  FullscreenExt,
  UndoExt,
  RedoExt,
  AiExt,
  FocusExt,
  LineHeightExt,
  HocuspocusExt,
  ImageBubbleMenu,
  VideoBubbleMenu,
  MathBubbleMenu,
  TableBubbleMenu,
  TrailingNodeExt,
  DragHandle,
  SlashCommand,
  SectionExt,
  CopyPasteExt,
  UploadManagerExt,
  OutlineExt
} from "@codecoderun/vivid";

const vars = useThemeVars();
function handleUpload(file, per) {

  let n = 0;
  return new Promise((resolve) => {
    const t = setInterval(() => {
      n+=20;
      per(n);
      if (n === 100) {
        const url = URL.createObjectURL(file);
        clearInterval(t);
        resolve(url);
      }
    }, 1000);
  });
}

const content = ref('<h1>âŒ¨ï¸å¯Œæ–‡æœ¬ç¼–è¾‘å™¨<span style="color: rgb(247, 6, 126)">ğŸ¥³ğŸ¥³ğŸ¥³</span></h1><blockquote><p><span style="color: rgb(118, 130, 164)"><em>åŸºäºæ— å¤´ç¼–è¾‘å™¨ tiptap2.0å¼€å‘ï¼Œ</em></span></p><p><span style="color: rgb(247, 6, 126)"><strong><em>tiptapå¤§æ³•å¥½ï¼ï¼ï¼</em></strong></span></p></blockquote><h2>ç‰¹æ€§é¢„è§ˆåˆ—è¡¨</h2><ul><li><p>ç²—ä½“</p></li><li><p>æ–œä½“</p></li><li><p>ä¸‹åˆ’çº¿</p></li><li><p>åˆ é™¤çº¿</p></li><li><p>é«˜äº®</p></li><li><p>å­—ä½“é¢œè‰²</p></li><li><p>æ–‡å­—å¯¹é½æ–¹å¼</p><ul><li><p>å·¦å¯¹é½</p></li><li><p>å³å¯¹é½</p></li><li><p>å±…ä¸­</p></li><li><p>ä¸¤ç«¯å¯¹é½</p></li></ul></li><li><p>ä¸Šè§’æ ‡</p></li><li><p>ä¸‹è§’æ ‡</p></li><li><p>æ ‡é¢˜1~6</p></li><li><p>æ— åºåˆ—è¡¨</p></li><li><p>æœ‰åºåˆ—è¡¨</p></li><li><p>ä»»åŠ¡åˆ—è¡¨</p></li><li><p>å¼•ç”¨å—</p></li><li><p>åˆ†éš”çº¿</p></li><li><p>è¶…é“¾æ¥</p></li><li><p>å›¾ç‰‡æ’å…¥ã€ç¼–è¾‘ã€æµ®åŠ¨</p></li><li><p>è§†é¢‘æ’å…¥ã€ç¼–è¾‘ã€æµ®åŠ¨</p></li><li><p>æ•°å­¦å…¬å¼æ’å…¥ã€ç¼–è¾‘</p></li><li><p>ä»£ç å—æ’å…¥ã€é«˜äº®</p></li><li><p>è¡¨æ ¼æ’å…¥ã€ç¼–è¾‘</p></li><li><p>å…¨å±åˆ‡æ¢</p></li><li><p>æ°”æ³¡èœå•</p></li><li><p>é€‚é…å¤œé—´æ¨¡å¼</p></li><li><p>tabå¿«æ·é”®ç¼©è¿›</p></li><li><p><span style="color: rgb(255, 66, 53)">ç±»ä¼¼135ç¼–è¾‘å™¨å†…å®¹å—å¤åˆ¶ç²˜è´´æ’å…¥</span></p></li><li><p><span style="color: rgb(255, 66, 53)">è¡Œé«˜è°ƒèŠ‚</span></p></li><li><p><span style="color: rgb(255, 66, 53)">æ–‡æ¡£å¤§çº²</span></p></li><li><p><span style="color: rgb(255, 66, 53)">è¡Œçº§Contextèœå•</span></p></li><li><p><span style="color: rgb(255, 66, 53)">SlashCommand</span></p></li><li><p><span style="color: rgb(255, 66, 53)">å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼Œæ”¯æŒå¤åˆ¶ç²˜è´´ä¸Šä¼ æ’å…¥å›¾ç‰‡</span></p></li></ul><h2>ç‰¹æ€§æ¼”ç¤º</h2><h3>æ–‡å­—æ ·å¼</h3><p><span style="color: rgb(51, 51, 51)"><strong>åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚</strong></span></p><p><span style="color: rgb(51, 51, 51)"><em>åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚</em></span></p><p><span style="color: rgb(51, 51, 51)"><u>åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚</u></span></p><p><span style="color: rgb(51, 51, 51)"><s>åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚</s></span></p><p><span style="color: rgb(51, 51, 51)"><mark data-color="none" style="background-color: none">åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚</mark></span></p><p><span style="color: rgb(247, 6, 126)">åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚</span></p><p></p><h3>æ–‡å­—å¯¹é½æ–¹å¼</h3><p>åºŠå‰æ˜æœˆå…‰ï¼Œ</p><p style="text-align: center">ç–‘æ˜¯åœ°ä¸Šéœœã€‚</p><p style="text-align: right">ä¸¾å¤´æœ›æ˜æœˆï¼Œ</p><p style="text-align: justify">ä½å¤´æ€æ•…ä¹¡ã€‚</p><h3>å›¾ç‰‡</h3><p><img src="https://raw.githubusercontent.com/pumelotea/happyboot-tiger/master/assets/light.png" keepratio="true" width="400" height="300" data-display="inline"> <img src="https://raw.githubusercontent.com/pumelotea/happyboot-tiger/d78c4e4e19ed886a55a577ceb64d5bba83b170cc/assets/dark.png" keepratio="true" width="400" height="300" data-display="inline"></p><h3>è§†é¢‘</h3><p><video src="https://media.w3.org/2010/05/sintel/trailer.mp4" keepratio="true" controls="false" loop="false" muted="false" width="546" height="325" data-display="inline"></video></p><h3>æ— åºåˆ—è¡¨</h3><ul><li><p>åºŠå‰æ˜æœˆå…‰ï¼Œ</p></li><li><p>ç–‘æ˜¯åœ°ä¸Šéœœã€‚</p></li><li><p>ä¸¾å¤´æœ›æ˜æœˆï¼Œ</p></li><li><p>ä½å¤´æ€æ•…ä¹¡ã€‚</p></li></ul><h3>æœ‰åºåˆ—è¡¨</h3><ol><li><p>åºŠå‰æ˜æœˆå…‰ï¼Œ</p></li><li><p>ç–‘æ˜¯åœ°ä¸Šéœœã€‚</p></li><li><p>ä¸¾å¤´æœ›æ˜æœˆï¼Œ</p></li><li><p>ä½å¤´æ€æ•…ä¹¡ã€‚</p></li></ol><h3>ä»»åŠ¡åˆ—è¡¨</h3><ul><li><p>åºŠå‰æ˜æœˆå…‰ï¼Œ</p></li><li><p>ç–‘æ˜¯åœ°ä¸Šéœœã€‚</p></li><li><p>ä¸¾å¤´æœ›æ˜æœˆï¼Œ</p></li><li><p>ä½å¤´æ€æ•…ä¹¡ã€‚</p></li></ul><h3>è¶…é“¾æ¥</h3><p><a target="_blank" rel="noopener noreferrer nofollow" href="https://happykit.org">æˆ‘æ˜¯ä¸€ä¸ªè¶…é“¾æ¥è·³åˆ°å“ªå¥½å‘¢ï¼Ÿï¼Ÿï¼Ÿ</a></p><h3>æ•°å­¦å…¬å¼</h3><p><span tex="\\displaystyle \\left( \\sum_{k=1}^n a_k b_k \\right)^2 \\leq \\left( \\sum_{k=1}^n a_k^2 \\right) \\left( \\sum_{k=1}^n b_k^2 \\right)\n' +
  '\n' +
  '"></span></p><h3>åˆ†éš”çº¿</h3><hr><h3>ä»£ç å—</h3><pre><code class="language-javascript">function refresh () {\n' +
  '  height = refRoll1.value.clientHeight\n' +
  '  shadowHeight = refRoll2.value.clientHeight\n' +
  '  if (shadowHeight !== height) {\n' +
  '    refRoll2.value.innerHTML = refRoll1.value.innerHTML\n' +
  '  }\n' +
  '  if (top &lt; 0) {\n' +
  '    if (Math.abs(top) &gt;= height) {\n' +
  '      const tmp = refRoll1.value\n' +
  '      refRoll1.value = refRoll2.value\n' +
  '      refRoll2.value = tmp\n' +
  '      top = 0\n' +
  '    }\n' +
  '    refRoll1.value.style.transform = translate3d(0,${top}px,0)\n' +
  '    refRoll2.value.style.transform = translate3d(0,${height + top}px,0)\n' +
  '  } else {\n' +
  '    if (Math.abs(top) &gt;= height) {\n' +
  '      const tmp = refRoll1.value\n' +
  '      refRoll1.value = refRoll2.value\n' +
  '      refRoll2.value = tmp\n' +
  '      top = -height\n' +
  '    }\n' +
  '    refRoll1.value.style.transform = translate3d(0,${top}px,0)\n' +
  '    refRoll2.value.style.transform = translate3d(0,${top - height}px,0)\n' +
  '  }\n' +
  '}</code></pre><h3>è¡¨æ ¼</h3><ul><li><p>æ”¯æŒæ–‡å­—çš„ç‰¹æ€§</p></li><li><p>æ”¯æŒå•å…ƒæ ¼åˆå¹¶</p></li><li><p>æ”¯æŒæ’å…¥å›¾ç‰‡</p></li><li><p>æ”¯æŒæ’å…¥è§†é¢‘</p></li><li><p>æ”¯æŒæ’å…¥æ•°å­¦å…¬å¼</p></li><li><p>æ”¯æŒæ’å…¥è¶…é“¾æ¥</p></li><li><p>æ”¯æŒæ’å…¥ä»£ç å—</p></li><li><p>æ”¯æŒæ’å…¥åˆ—è¡¨</p></li></ul><table style="minWidth: 299px"><colgroup><col style="width: 224px"><col><col><col></colgroup><tbody><tr><th colspan="1" rowspan="1" colwidth="224"><p>å§“å</p></th><th colspan="1" rowspan="1"><p>å¹´é¾„</p></th><th colspan="1" rowspan="1"><p>èº«é«˜</p></th><th colspan="1" rowspan="1"><p>ä½“é‡</p></th></tr><tr><td colspan="1" rowspan="1" colwidth="224" style="background-color: null"><p>å°ç±³</p></td><td colspan="1" rowspan="1" style="background-color: null"><p>10</p></td><td colspan="1" rowspan="1" style="background-color: null"><p>150</p></td><td colspan="1" rowspan="1" style="background-color: null"><p>40</p></td></tr><tr><td colspan="1" rowspan="1" colwidth="224" style="background-color: null"><p>å°å¼ </p></td><td colspan="1" rowspan="1" style="background-color: null"><p>12</p></td><td colspan="1" rowspan="1" style="background-color: null"><p>160</p></td><td colspan="1" rowspan="1" style="background-color: null"><p>48</p></td></tr><tr><td colspan="1" rowspan="2" colwidth="224" style="background-color: null"><p></p></td><td colspan="1" rowspan="1" style="background-color: null"><p></p></td><td colspan="1" rowspan="1" style="background-color: null"><p></p></td><td colspan="1" rowspan="1" style="background-color: null"><p></p></td></tr><tr><td colspan="1" rowspan="1" style="background-color: null"><p></p></td><td colspan="1" rowspan="1" style="background-color: null"><p></p></td><td colspan="1" rowspan="1" style="background-color: null"><p></p></td></tr><tr><td colspan="1" rowspan="1" colwidth="224" style="background-color: null"><p></p></td><td colspan="2" rowspan="1" style="background-color: null"><p></p></td><td colspan="1" rowspan="1" style="background-color: null"><p></p></td></tr></tbody></table><h3>è§’æ ‡</h3><p>æˆ‘æ˜¯æ–‡å­—<sup>å“ˆå“ˆå“ˆå“ˆå“ˆ</sup></p><p>æˆ‘æ˜¯æ–‡å­—<sub>å“ˆå“ˆå“ˆå“ˆå“ˆ</sub></p><p></p><h3>AIåŠ©æ‰‹æ”¯æŒ</h3><p>è¯¦ç»†è§æ–‡æ¡£</p><h3>å¤šäººååŒæ”¯æŒ</h3><p>è¯¦ç»†è§æ–‡æ¡£</p><p></p>')
</script>
<template>
  <div style="height: 500px;margin-bottom: 10px">
    <vivid-editor
      v-model="content"
      :dark="isDark"
    >
      <drag-handle></drag-handle>
      <slash-command></slash-command>

      <template #menu>
        <div class="menu-bar">
          <document-ext />
          <paragraph-ext />
          <hard-break-ext />
          <indent-ext />
          <history-ext />
          <dropcursor-ext />
          <gapcursor-ext />
          <text-ext />
          <placeholder-ext />
          <character-count-ext />
          <text-style-ext />
          <focus-ext />
          <trailing-node-ext />
          <section-ext />
          <copy-paste-ext />
          <upload-manager-ext :handleUpload="handleUpload"/>

          <undo-ext />
          <redo-ext />
          <format-clear-ext />
          <divider-ext />
          <bold-ext />
          <italic-ext />
          <strike-ext />
          <underline-ext />
          <color-ext />
          <highlight-ext />
          <divider-ext />
          <heading-ext />
          <divider-ext />
          <text-align-ext />
          <line-height-ext />
          <divider-ext />
          <subscript-ext />
          <superscript-ext />
          <divider-ext />
          <image-ext :handleUpload="handleUpload" />
          <video-ext :handleUpload="handleUpload" />
          <link-ext />
          <divider-ext />
          <table-ext />
          <math-ext />
          <code-ext />
          <code-block-ext />
          <block-quote-ext />
          <horizontal-rule-ext />
          <bullet-list-ext />
          <list-item-ext />
          <ordered-list-ext />
          <task-list-ext />
          <divider-ext />
          <outline-ext/>
          <fullscreen-ext />
        </div>
      </template>
      <template v-slot:bubble-menu="{nodeType}">
        <div class="bubble-menu-bar">
          <template v-if="nodeType === 'text'">
            <bold-ext />
            <italic-ext />
            <strike-ext />
            <underline-ext />
            <divider-ext />
            <color-ext />
            <highlight-ext />
            <link-ext />
            <divider-ext />
            <text-align-ext />
          </template>
          <template v-if="nodeType === 'image'">
            <image-bubble-menu />
          </template>
          <template v-if="nodeType === 'video'">
            <video-bubble-menu />
          </template>
          <template v-if="nodeType === 'math'">
            <math-bubble-menu />
          </template>
          <template v-if="nodeType === 'table'">
            <table-bubble-menu />
          </template>
        </div>
      </template>
    </vivid-editor>
  </div>
  <n-card title="è¾“å‡ºHTML">
    <n-input
      v-model:value="content"
      type="textarea"
      rows="15"
    />
  </n-card>
</template>
<style scoped>
.menu-bar {
  display: flex;
  align-items: center;
  width: 100%;
  flex-wrap: wrap;
  padding: 5px 5px;
  gap: 2px;
  background-color: v-bind(vars.baseColor);
  box-sizing: border-box;
  border-bottom: 1px solid;
  border-color: v-bind(vars.borderColor);
}

.bubble-menu-bar {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  padding: 4px 5px;
  background: v-bind(vars.popoverColor);
  border-radius: 3px;
  box-shadow: v-bind(vars.boxShadow2);
}
</style>
